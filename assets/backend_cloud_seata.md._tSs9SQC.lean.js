import{_ as E,D as h,o as e,c as d,k as s,a as i,I as n,w as a,b as k,a4 as r,R as t}from"./chunks/framework.3IDgao2s.js";const V=JSON.parse('{"title":"1. 分布式事务简介","description":"","frontmatter":{},"headers":[],"relativePath":"backend/cloud/seata.md","filePath":"backend/cloud/seata.md"}'),g={name:"backend/cloud/seata.md"},c=t("",27),y={start:"2"},b=t("",15),o=s("thead",null,[s("tr",null,[s("th",{style:{"text-align":"left"}},"优点"),s("th",{style:{"text-align":"left"}},"缺点")])],-1),u={style:{"text-align":"left"}},F=s("td",{style:{"text-align":"left"}},[i("一阶段要锁定数据库资源，等待二阶段结束才能能够释放，性能较差。"),s("br"),i("依赖关系型数据库实现事务")],-1),m=t("",16),A=s("h3",{id:"_2-at模式存在的脏写问题",tabindex:"-1"},[i("2. AT模式存在的脏写问题 "),s("a",{class:"header-anchor",href:"#_2-at模式存在的脏写问题","aria-label":'Permalink to "2. AT模式存在的脏写问题"'},"​")],-1),D=s("blockquote",null,[s("p",null,[i("假设原有数据为 "),s("code",null,"{id: 1, money: 100}")])],-1),C=t("",6),B=s("code",null,"{id: 1, money: 100}",-1),f=t("",23),_=s("li",null,"修改account-service，编写try、confirm、cancel逻辑",-1),x=s("li",null,"try业务:添加冻结金额，扣减可用金额",-1),v=s("li",null,"confirm业务:删除冻结金额",-1),T=s("li",null,"cancel业务:删除冻结金额，回滚可用金额",-1),q=s("p",null,[s("strong",null,"空回滚")],-1),S=s("p",null,[s("img",{src:"http://upyuncdn.lesscoding.net/image-20250422162213046.png",alt:"image-20250422162213046"})],-1),P=s("p",null,[s("strong",null,"业务悬挂")],-1),I=t("",12),N=t("",13);function L(R,M,U,z,w,O){const l=h("font"),p=h("Mermaid");return e(),d("div",null,[c,s("ol",y,[s("li",null,[i("添加配置，"),n(l,{color:"red"},{default:a(()=>[i("这种公用的直接放到 shared共享的配置中即可")]),_:1})])]),b,s("table",null,[o,s("tbody",null,[s("tr",null,[s("td",u,[s("strong",null,[n(l,{color:"red"},{default:a(()=>[i("强一致性，满足ACID原则，常见数据库都支持，且没有代码侵入")]),_:1})])]),F])])]),m,(e(),k(r,null,{default:a(()=>[n(p,{id:"mermaid-725",class:"mermaid my-class",graph:"flowchart%20TD%0A%20%20%20%20S%5B%E5%BC%80%E5%A7%8B%5D%20--%3E%20A%5B%E6%B3%A8%E5%86%8C%E5%88%86%E6%94%AF%E4%BA%8B%E5%8A%A1%5D%0A%20%20%20%20A%20--%3E%20B%5B%E8%AE%B0%E5%BD%95undo-log%E6%95%B0%E6%8D%AE%E5%BF%AB%E7%85%A7%5D%0A%20%20%20%20B%20--%3E%20C%5B%E6%89%A7%E8%A1%8C%E4%B8%9A%E5%8A%A1sql%5D%0A%20%20%20%20C%20--%3E%20D%5B%E6%8F%90%E4%BA%A4%E5%B9%B6%E6%8A%A5%E5%91%8A%E4%BA%8B%E5%8A%A1%E7%8A%B6%E6%80%81%5D%0A%20%20%20%20D%20--%3E%20E%5B%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E6%8F%90%E4%BA%A4%5D%0A%20%20%20%20E%20--%3E%20%7C%E6%98%AF%7C%20F%5B%E5%88%A0%E9%99%A4%E5%BF%AB%E7%85%A7%5D%0A%20%20%20%20E%20--%3E%20%7C%E5%90%A6%7C%20G%5B%E8%AF%BB%E5%8F%96%E5%BF%AB%E7%85%A7%2C%E6%81%A2%E5%A4%8D%E6%95%B0%E6%8D%AE%5D%0A%20%20%20%20F%20--%3E%20H%5B%E7%BB%93%E6%9D%9F%5D%0A%20%20%20%20G%20--%3E%20H%0A"})]),fallback:a(()=>[i(" Loading... ")]),_:1})),A,D,s("ol",null,[C,s("li",null,[s("strong",null,[n(l,{color:"red"},{default:a(()=>[i("事务A 回滚事务，根据快照数据 "),B,i(" 回滚。")]),_:1})])])]),f,s("ol",null,[_,x,v,T,s("li",null,[i("保证Confirm 和 Cancel 方法的"),n(l,{color:"red"},{default:a(()=>[i("幂等性")]),_:1})]),s("li",null,[i("允许"),n(l,{color:"red"},{default:a(()=>[i("空回滚")]),_:1})]),s("li",null,[i("拒绝"),n(l,{color:"red"},{default:a(()=>[i("业务悬挂")]),_:1})])]),q,s("blockquote",null,[s("p",null,[i("当某个分支事务的try阶段阻塞时，可能导致全局事务超时而出发二阶段的Cancel操作在未执行try操作时先执行了cancel操作， 这时cancel不能做回滚，就是"),n(l,{color:"red"},{default:a(()=>[i("空回滚")]),_:1})])]),S,P,s("blockquote",null,[s("p",null,[i("对于已经 空回滚 的业务，如果以后继续执行 try操作， 就永远不可能 Confirm 和 Cancel ，这就是"),n(l,{color:"red"},{default:a(()=>[i("业务悬挂")]),_:1}),i(", 所以应当阻止执行空回滚后的try 避免业务悬挂")])]),I,(e(),k(r,null,{default:a(()=>[n(p,{id:"mermaid-1082",class:"mermaid my-class",graph:"graph%20TD%0A%20%20subgraph%20%E6%99%AE%E9%80%9A%E4%BA%8B%E5%8A%A1%0A%20%20%20%20T1%20--%3E%20T2%20--%3E%20T3%20--Failed--%3E%20Tn%0A%20%20end%0A%20%20subgraph%20%E8%A1%A5%E5%81%BF%E4%BA%8B%E5%8A%A1%0A%20%20%20%20C3%20--%3E%20C2%20--%3E%20C1%0A%20%20end%0A%20%20T3%20--%3E%20C3%0A"})]),fallback:a(()=>[i(" Loading... ")]),_:1})),N])}const G=E(g,[["render",L]]);export{V as __pageData,G as default};
