import{_ as s,o as a,c as e,R as n}from"./chunks/framework.3IDgao2s.js";const b=JSON.parse('{"title":"1. 安装Jenkins和Maven","description":"","frontmatter":{},"headers":[],"relativePath":"server/jenkins.md","filePath":"server/jenkins.md"}'),i={name:"server/jenkins.md"},t=n(`<div class="tip custom-block"><p class="custom-block-title">TIP</p><p><a href="https://www.bilibili.com/video/BV1bS4y1471A?spm_id_from=333.788.player.switch&amp;vd_source=d9d3eb78433e98d94cd75ddf5ac0382b&amp;p=2" target="_blank" rel="noreferrer">当前进度 2/29</a></p></div><h1 id="_1-安装jenkins和maven" tabindex="-1">1. 安装Jenkins和Maven <a class="header-anchor" href="#_1-安装jenkins和maven" aria-label="Permalink to &quot;1. 安装Jenkins和Maven&quot;">​</a></h1><blockquote><p><a href="https://www.jenkins.io/zh/" target="_blank" rel="noreferrer">官网地址</a></p></blockquote><ol><li>首先先安装个jdk，建议11吧 <a href="/notes/server/centosInit.html#_1-jdk安装">参考链接</a>,</li></ol><blockquote><p>最后的支持JDK11的版本是2.361.4, 具体的支持情况可以<a href="https://mirrors.jenkins.io/war-stable/" target="_blank" rel="noreferrer">参考官网</a></p></blockquote><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 试了试这个 2.361有很多依赖安装不上 还是安装最新的和 JDK17吧，或者用docker安装</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://download.java.net/java/GA/jdk17.0.2/dfd4a8d0985749f896bed50d7138ee7f/8/GPL/openjdk-17.0.2_linux-x64_bin.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 复制到 /usr/local</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -zxvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  openjdk-17.0.2_linux-x64_bin.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jdk-17.0.2/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JAVA_HOME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/usr/local/jdk-17.0.2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PATH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$PATH</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$JAVA_HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/bin</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/profile</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="2"><li><a href="https://www.jenkins.io/zh/doc/pipeline/tour/getting-started/" target="_blank" rel="noreferrer">下载jenkins war包</a>,或者直接使用命令下载</li></ol><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://mirrors.jenkins.io/war-stable/latest/jenkins.war</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="3"><li>原神 启动！</li></ol><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">java</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -jar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/jenkins/war</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-text vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>启动后可以看到以下内容，当然了访问jenkins也会提示的</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Please use the following password to proceed to installation:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>4580033262024cc882f736c78d3faf18</span></span>
<span class="line"><span></span></span>
<span class="line"><span>This may also be found at: /root/.jenkins/secrets/initialAdminPassword</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>启动完成之后，按照默认的安装差件就行了，如果安装不上可以先创建用户。</p><p>等会再<code>Dashborad --&gt; Manage Jenkins --&gt; Plugin Manager --&gt; Advanced</code>配置一下新的路径</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 直接访问这个地址也是可以的</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http://192.168.159.138:8080/pluginManager/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在<code>Update Site</code>中填写地址</p><div class="language-text vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>http://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></blockquote><ol start="4"><li>修改插件安装地址</li></ol><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jenkins/updates</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> default.json</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> default_bak.json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> default.json</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 把 https://updates.jenkins.io/download 替换成 http://mirrors.tuna.tsinghua.edu.cn/jenkins</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">:1,$s/https:\\/\\/updates.jenkins.io\\/download/http:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/jenkins/g</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="5"><li>推荐的插件有</li></ol><table><thead><tr><th>插件</th><th>插件</th><th>插件</th><th>插件</th></tr></thead><tbody><tr><td>Folders</td><td>OWASP markup Formatter</td><td>Build Timeout</td><td>Credentials Binding</td></tr><tr><td>Timestamper</td><td>Workspace Cleanup</td><td>Ant</td><td>Gradle</td></tr><tr><td>Pipeline</td><td>Github Branch Source</td><td>Pipeline: Github Groovy Libraries</td><td>Pipeline Graph View</td></tr><tr><td>Git</td><td>SSH Build Agents</td><td>Matrix Authorization Strategy</td><td>PAM Authentication</td></tr><tr><td>LDAP</td><td>Email Extension</td><td>Mailer</td><td>Dark Theme</td></tr><tr><td>Localization: Chinese(Simplified)</td><td>Maven Integration Plugin</td><td>Publish over ssh</td><td></td></tr></tbody></table><ol start="6"><li>安装maven</li></ol><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> maven</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="7"><li>给jenkins安装maven插件</li></ol><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">http://192.168.159.138:8080/manage/pluginManager/available</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 搜索插件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">maven</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> integration</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="8"><li>安装git</li></ol><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h1 id="_2-新建item" tabindex="-1">2. 新建item <a class="header-anchor" href="#_2-新建item" aria-label="Permalink to &quot;2. 新建item&quot;">​</a></h1><blockquote><p>安装完插件<code>maven integration</code>之后，<code>new item</code>的时候就能看到构建maven项目了</p></blockquote><ol><li>创建item选择maven项目</li></ol><p><img src="http://upyuncdn.lesscoding.net/image-20241210150257610.png" alt="image-20241210150257610"></p><ol start="2"><li>源码管理里边<code>Git</code>填上源码地址,私有项目的话填上凭证</li></ol><p><img src="http://upyuncdn.lesscoding.net/image-20241210154208468.png" alt="image-20241210154208468"></p><ol start="3"><li>下边的Build填写pom的地址，这个pom.xml是相对于git根目录的。</li></ol><p><img src="http://upyuncdn.lesscoding.net/image-20241210152029023.png" alt="image-20241210152029023"></p><blockquote><p>出现这个问题不用慌张啊，直接点 <code>the tool configuration</code>去配置一下maven路径就好了。</p><p>我用的是yum安装的，所以路径是<code>usr/share/maven</code>,如果路径不对的下边会有一行黄色的文字提示的。</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 可以用查看一下maven 的安装位置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">whereis</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> maven</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></blockquote><p><img src="http://upyuncdn.lesscoding.net/image-20241210152825565.png" alt="image-20241210152825565"></p><ol start="4"><li>POST Steps 可以在打完包后执行后续操作</li></ol><h1 id="_3-打包产物自动部署" tabindex="-1">3. 打包产物自动部署 <a class="header-anchor" href="#_3-打包产物自动部署" aria-label="Permalink to &quot;3. 打包产物自动部署&quot;">​</a></h1><ol><li>安装插件</li></ol><blockquote><p><a href="http://192.168.159.138:8080/manage/pluginManager/available" target="_blank" rel="noreferrer">http://192.168.159.138:8080/manage/pluginManager/available</a>搜索 <code>Publish over SSH</code></p></blockquote><ol start="2"><li>配置远程服务器</li></ol><blockquote><p><a href="http://192.168.159.138:8080/manage/configure" target="_blank" rel="noreferrer">http://192.168.159.138:8080/manage/configure</a>的SSH Server中配置，密码的话再高级选项第一个。配置完成可是点击 <code>Test configuration</code>验证是否正确</p></blockquote><table><thead><tr><th>参数</th><th>描述</th><th>示例</th></tr></thead><tbody><tr><td></td><td></td><td></td></tr></tbody></table><ol start="3"><li>修改item配置</li></ol><blockquote><p>项目配置里找到<code>Post Steps</code>,选择<code>Add post-build-step</code>里边的<code>Send files oe executr commands over SSH</code>.</p></blockquote><table><thead><tr><th>参数</th><th>描述</th><th>示例</th></tr></thead><tbody><tr><td>source fils</td><td>打包产物的位置，以<code>~/.jenkins/workspace</code>为基准，支持通配符<code>*.jar</code></td><td><code>**/java_test/target/*.jar</code><br><code>**/java_test*.jar</code></td></tr><tr><td>exec command</td><td>在目标服务器执行的命令</td><td></td></tr><tr><td>remote directory</td><td>传输到的远程目录</td><td><code>java_test</code></td></tr><tr><td>remove prefix</td><td>删除远程目录的前缀</td><td><code>java_test/target</code></td></tr></tbody></table><blockquote><p>保存之后，点击Build Now执行构建，提示success但是没有成功传输文件。</p></blockquote><div class="language-text vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>SSH: Connecting from host [localhost.localdomain]</span></span>
<span class="line"><span>SSH: Connecting with configuration [Ubuntu-192.168.159.135] ...</span></span>
<span class="line"><span>channel stopped</span></span>
<span class="line"><span>SSH: EXEC: completed after 202 ms</span></span>
<span class="line"><span>SSH: Disconnecting configuration [Ubuntu-192.168.159.135] ...</span></span>
<span class="line"><span>SSH: Transferred 0 file(s)</span></span>
<span class="line"><span>Finished: SUCCESS</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>这是因为我配置的哪个<code>**/java_test/target/*.jar</code>没有匹配到我的jar包，改成<code>**/java_test*.jar</code>就可以了。</p></blockquote>`,45),l=[t];function p(r,d,h,o,c,k){return a(),e("div",null,l)}const g=s(i,[["render",p]]);export{b as __pageData,g as default};
